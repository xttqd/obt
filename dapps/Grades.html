<!DOCTYPE html>
<html>

<head>
    <title>Grade Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }

        .form-group {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #45a049;
        }

        #result {
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .grade-info {
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .section {
            margin-bottom: 20px;
        }

        .grade-range {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }

        .stat-label {
            font-weight: bold;
            color: #2e7d32;
        }

        .stat-value {
            font-size: 1.2em;
            color: #1b5e20;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Grade Management System</h1>

        <div class="section">
            <h2>Add Grade</h2>
            <div class="form-group">
                <label for="title">Subject/Title:</label>
                <input type="text" id="title" placeholder="Enter subject or title">
            </div>
            <div class="form-group">
                <label for="grade">Grade (1-5):</label>
                <input type="number" id="grade" placeholder="Enter grade (1-5)" min="1" max="5">
                <div class="grade-range">Valid grades are between 1 and 5</div>
            </div>
            <button onclick="addGrade()">Add Grade</button>
        </div>

        <div class="section">
            <h2>View Grade Statistics</h2>
            <div class="form-group">
                <label for="searchTitle">Search by Subject/Title:</label>
                <input type="text" id="searchTitle" placeholder="Enter subject or title to search">
            </div>
            <button onclick="getGrades()">View Statistics</button>
            <div id="gradeInfo" class="grade-info"></div>
        </div>

        <div id="result"></div>
    </div>

    <script>
        let web3;
        let contract;
        const contractAddress = '0x8438Ad1C834623CfF278AB6829a248E37C2D7E3f'; // Replace with your deployed contract address
        const abi = [
            {
                "inputs": [
                    {
                        "internalType": "string",
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "grade",
                        "type": "uint256"
                    }
                ],
                "name": "MyGrade",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "name": "results",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "sum",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "average",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        async function init() {
            try {
                // Connect to Hardhat provider
                web3 = new Web3('http://127.0.0.1:8545');
                contract = new web3.eth.Contract(abi, contractAddress);
            } catch (error) {
                console.error('Error initializing Web3:', error);
                document.getElementById('result').innerHTML = `Error: ${error.message}`;
            }
        }

        async function addGrade() {
            try {
                const title = document.getElementById('title').value;
                const grade = parseInt(document.getElementById('grade').value);

                if (!title || !grade) {
                    alert('Please fill in all fields');
                    return;
                }

                if (grade < 1 || grade > 5) {
                    alert('Grade must be between 1 and 5');
                    return;
                }

                const accounts = await web3.eth.getAccounts();
                await contract.methods.MyGrade(title, grade).send({ from: accounts[0] });
                document.getElementById('result').innerHTML = 'Grade added successfully!';

                // Clear input fields
                document.getElementById('title').value = '';
                document.getElementById('grade').value = '';
            } catch (error) {
                document.getElementById('result').innerHTML = `Error: ${error.message}`;
            }
        }

        async function getGrades() {
            try {
                const title = document.getElementById('searchTitle').value;

                if (!title) {
                    alert('Please enter a subject/title to search');
                    return;
                }

                const accounts = await web3.eth.getAccounts();
                const result = await contract.methods.results(title).call({ from: accounts[0] });

                if (result.amount === '0') {
                    document.getElementById('gradeInfo').innerHTML = 'No grades found for this subject/title.';
                    return;
                }

                document.getElementById('gradeInfo').innerHTML = `
                    <h3>Grade Statistics for: ${title}</h3>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-label">Number of Grades</div>
                            <div class="stat-value">${result.amount}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total Sum</div>
                            <div class="stat-value">${result.sum}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Average Grade</div>
                            <div class="stat-value">${result.average}</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('gradeInfo').innerHTML = `Error: ${error.message}`;
            }
        }

        init();
    </script>
</body>

</html>